<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adopt a Pet</title>
    <link rel="stylesheet" href="/CSS/navigation.css">
    <link rel="stylesheet" href="/CSS/adopt-styles.css">
    <style>
        /* body {
            font-family: Arial, sans-serif;
            background: #f9f9f9;
            display: flex;
            justify-content: center;
            padding: 30px;
        } */

        .form-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* center perfectly */
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 50%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            /* scroll if content too tall */
            z-index: 9999;
            /* puts this elemesnt on top of which ever elements that have less than this elements value.. cool */
            scrollbar-width: none;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .form-group label {
            /* margin-left: 20%; */
            width: 220px;
            font-weight: bold;
            flex: 1;
        }

        .form-group input,
        .form-group select {
            /* width: 50%; */
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        button {
            width: 30%;
            padding: 12px;
            background-color: white;
            color: #1c5373;
            border: 2px solid #1c5373;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #1c5373;
            border: 2px solid #1c5373;
            color: #ffffff;
        }
    </style>

</head>

<body>
    <header class="navbar">
        <img src="/IMAGES/logo_2.png" alt="logo_2" class="logo_2">
        <nav class="nav-links">
            <a href="/" id="home">Home</a>
            <a href="/pet-products" id="pet-products">Pet Products</a>
            <a href="/about-developers" id="about-developers">Contact Us</a>
            <a href="/login" id="login">Login</a>
        </nav>
    </header>

    <main>
        <section class="adopt-section">
            <div class="form-container" style="display: none;" id="form-container">
                <h2>Pet Adoption Form</h2>
                <form method="post" style="margin: 5%;" id="form">

                    <div class="form-group">
                        <label for="pet_name">Pet Name:</label>
                        <input type="text" id="pet_name" name="pet_name" required>
                    </div>

                    <div class="form-group">
                        <label for="full_name">Full Name:</label>
                        <input type="text" id="full_name" name="full_name" placeholder="Enter full name" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" placeholder="Enter email" required>
                    </div>

                    <div class="form-group">
                        <label for="address">Address:</label>
                        <input type="text" id="address" name="address" placeholder="Enter an address" required>
                    </div>

                    <div class="form-group">
                        <label for="contact_number">Contact Number:</label>
                        <input type="tel" id="contact_number" name="contact_number" placeholder="Enter Phone number"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="occupation">Occupation:</label>
                        <input type="text" id="occupation" name="occupation" placeholder="Enter jobtitle" required>
                    </div>

                    <div class="form-group">
                        <label for="owned-pet">Have you owned a pet before?</label>
                        <select id="owned-pet" name="owned_pet" required>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="hours_away">Hours away from home daily:</label>
                        <input type="number" id="hours_away" name="hours_away" min="0" placeholder="Enter hours (8)"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="family">Family members with you:</label>
                        <input type="number" id="family" name="family" min="0"
                            placeholder="Enter number of family members" required>
                    </div>

                    <div class="form-group">
                        <label for="roomates">Number of roomates with you (excluding family) :</label>
                        <input type="number" id="roomates" name="roomates" min="0"
                            placeholder="Enter number of roomates" required>
                    </div>

                    <div class="form-group">
                        <label for="children">Number of children:</label>
                        <input type="number" id="children" name="children" min="0"
                            placeholder="Enter number of children" required>
                    </div>

                    <div class="form-group">
                        <label for="agree_to_have_pet">Has everyone agreed?</label>
                        <select id="agree_to_have_pet" name="agree_to_have_pet">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button type="submit" id="edit">Submit</button>
                        <button type="button" id="cancel">Cancel</button>
                    </div>

                </form>
            </div>
            <h1>Adopt a Pet</h1>
            <p style="text-align: center;">Find your new best friend today!</p>

            <!-- Ginger -->
            <div class="pet-card">
                <div class="pet-image">
                    <img src="/IMAGES/cat1.jpeg" alt="Ginger">
                    <h2>Ginger</h2>
                </div>

                <div class="pet-details">
                    <p>Ginger is a playful and affectionate cat looking for a loving home.</p>
                    <div class="requirement">
                        <li>Requirements: Must have a cat-friendly environment.</li>
                    </div>
                    <button class="button" onclick="enterAdoptionFormFor('ginger')"> Adopt </button>

                </div>
            </div>

            <!-- Turbo -->
            <div class="pet-card">
                <div class="pet-image">
                    <img src="/IMAGES/cat2.jpeg" alt="Turbo">
                    <h2>Turbo</h2>
                </div>

                <div class="pet-details">
                    <p>Turbo is an energetic cat who loves to play and cuddle.</p>
                    <div class="requirement">
                        <li>Requirements: Must have a spacious area for play.</li>
                    </div>
                    <button class="button" onclick="enterAdoptionFormFor('turbo')"> Adopt </button>

                </div>
            </div>

            <!-- Ham -->
            <div class="pet-card">
                <div class="pet-image">
                    <img src="/IMAGES/hamster.jpeg" alt="Ham">
                    <h2>Ham</h2>
                </div>

                <div class="pet-details">
                    <p>Ham is a friendly hamster who loves to explore and play.</p>
                    <div class="requirement">
                        <li>Requirements: Must have a secure cage and plenty of toys.</li>
                    </div>
                    <button class="button" onclick="enterAdoptionFormFor('ham')"> Adopt </button>

                </div>
            </div>

            <!-- Rosey -->
            <div class="pet-card">
                <div class="pet-image">
                    <img src="/IMAGES/dog.jpeg" alt="Rosey">
                    <h2>Rosey</h2>
                </div>

                <div class="pet-details">
                    <p>Rosey is a loving dog who enjoys long walks and cuddles.</p>
                    <div class="requirement">
                        <li>Requirements: Must have a fenced yard for playtime.</li>
                    </div>
                    <button id="btn" class="button" onclick="enterAdoptionFormFor('rosey')"> Adopt </button>

                </div>
            </div>
        </section>

        <!-- A slide show for happily adopted -->
        <section class="happily-adopted-section" style="margin-top: 100px;">
            <h1>Happily Adopted Pets</h1>

            <div class="slideshow-container">

                <div class="pet-card slide">
                    <div class="pet-image">
                        <img src="/IMAGES/adoptedcat1.jpeg" alt="Happy Pet 1">
                    </div>
                    <div class="pet-details">
                        <p>Moon - Living his best life with his new family(dareens family)</p>
                    </div>


                </div>

                <div class="pet-card slide">
                    <div class="pet-image">
                        <img src="/IMAGES/adoptedcat2.jpeg" alt="Happy Pet 2">
                    </div>
                    <div class="pet-details">
                        <p>Molly - Enjoying her new home and loving it!</p>
                    </div>
                </div>

                <div class="pet-card slide">
                    <div class="pet-image">
                        <img src="/IMAGES/adoptedcat3.jpeg" alt="Happy Pet 3">
                    </div>
                    <div class="pet-details">
                        <p>Bella - Thriving in her forever home!</p>
                    </div>
                </div>

            </div>
        </section>

        <div id="popup"
            style="display: none; position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px 25px; border-radius: 8px; z-index: 1000;">
            âœ… Adoption request sent successfully!
        </div>
    </main>

    <script>
        const url = window.location.pathname;
        const pathParts = url.split('/');

        let userName = 'Guest'
        if (pathParts.length > 2)
            userName = pathParts[2];

        function enterAdoptionFormFor(requestedPet) {
            console.log("Form clicked")
            const formContainer = document.getElementById('form-container');
            formContainer.style.display = "block"

            const petName = document.getElementById('pet_name');
            petName.value = requestedPet;
            petName.disabled = true;


            if (pathParts.length > 2) { // user logged in.. then autofill the info
                fetch(`/userInfo/${userName}`)
                    .then(res => res.json())
                    .then(data => {

                        const user = data.user[0];
                        console.log(user);
                        document.getElementById('full_name').value = user.full_name
                        document.getElementById('email').value = user.email;
                        if (user.address)
                            document.getElementById('address').value = user.address;

                        if (user.contact_number)
                            document.getElementById('contact_number').value = user.contact_number;

                        if (user.occupation)
                            document.getElementById('occupation').value = user.occupation;
                    })

                    .catch(error => console.log(error));
            }

        }

        document.getElementById('cancel').addEventListener('click', () => {
            form.reset();
            document.getElementById('form-container').style.display = "none";

        });


        document.getElementById("form")
            .addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent page reload

                const formData = new FormData(this);
                const body = Object.fromEntries(formData.entries());

                const res = await fetch("/submit-contact-us-form", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(body)
                });

                document.getElementById("popup").style.display = "block"; // makes the message visible
                document.getElementById('form').reset(); // resets the form
                document.getElementById('form-container').style.display = "none"; // hides the form's container

                if (res.ok)
                    setTimeout(() => {
                        document.getElementById("popup").style.display = "none";
                    }, 3000);

                else
                    setTimeout(() => {
                        document.getElementById("popup").style.display = "none";
                        document.getElementById("popup").style.color = "red";
                    }, 3000);
            });


        // for slideshow
        let slideIndex = 0;
        const slides = document.querySelectorAll(".slide");

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle("active", i === index);
            });
        }


        function nextSlide() {
            slideIndex = (slideIndex + 1) % slides.length;
            showSlide(slideIndex);
        }

        // Initial display
        showSlide(slideIndex);
        setInterval(nextSlide, 3000); // Change every 3s
        if (pathParts.length > 2) {
            userName = pathParts[pathParts.length - 1];
            document.getElementById('home').href += `home/${userName}`;
            document.getElementById('pet-products').href += `/${userName}`;
            document.getElementById('about-developers').href += `/${userName}`;
            document.getElementById('login').removeAttribute('href'); // removes the link after signing in
            document.getElementById('login').innerHTML = 'Profile';

            fetch(`/profile/${userName}`)
                .then(res => res.json())
                .then(data => {
                    const user = data.user[0];
                    console.log(user);
                    document.getElementById('full_name').value = user.full_name
                    document.getElementById('email').value = user.email;
                    if (user.address)
                        document.getElementById('address').value = user.address;

                    if (user.contact_number)
                        document.getElementById('contact_number').value = user.contact_number;

                    if (user.occupation)
                        document.getElementById('occupation').value = user.occupation;

                }).catch(error => console.log(error));

            // to view the profile
            document.getElementById('login').addEventListener('click', () => {
                count++;
                const profile = document.getElementById('profile');
                profile.style.display = "flex";

                // for closing the profile by clicking on the profile
                if (count > 1) {
                    count = 0;
                    profile.style.display = "none";

                }
            });

            // shows the adoption forms
            const submittedForms = document.getElementById('forms-submitted');

            fetch(`/get-forms/${userName}`)
                .then(res => {
                    if (!res.ok) throw new Error("Failed to fetch forms");
                    return res.json();
                })
                .then(data => {
                    if (!Array.isArray(data) || data.length === 0) {
                        submittedForms.innerHTML += `<p>No adoption forms submitted.</p>`;
                        return;
                    }

                    const ul = document.createElement('ul');
                    data.forEach(form => {
                        const li = document.createElement('li');
                        li.textContent = `${form.pet_name} submitted`;
                        ul.appendChild(li);
                    });

                    submittedForms.appendChild(ul);
                })
                .catch(error => {
                    console.error("Error fetching forms:", error);
                    submittedForms.innerHTML += `<p style="color: red;">Unable to load forms.</p>`;
                });


            var address = document.getElementById('address');
            var contact_number = document.getElementById('contact_number');
            var occupation = document.getElementById('occupation');

            const editBtn = document.getElementById('edit');
            var editCount = 0;

            editBtn.addEventListener("click", async () => {
                editCount++;
                editBtn.textContent = "save"

                address.disabled = false;
                contact_number.disabled = false;
                occupation.disabled = false;

                if (editCount > 1) {
                    editBtn.textContent = "Edit"
                    editCount = 0;

                    address.disabled = true;
                    contact_number.disabled = true;
                    occupation.disabled = true;

                    const updateData = {
                        full_name: userName,
                        address: address.value,
                        contact_number: contact_number.value,
                        occupation: occupation.value
                    };


                    try {
                        const res = await fetch("/update-profile", {
                            method: "PUT",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(updateData)
                        });

                        const result = await res.json();

                        if (res.ok) {
                            alert("Profile updated successfully!");
                        } else {
                            alert("Update failed: " + result.message);
                        }
                    } catch (err) {
                        console.error("Update error:", err);
                        alert("Something went wrong.");
                    }

                }

            });

        }

    </script>


</body>

</html>